"""
Конфигурация VAK адаптации для визуализаций и движенческих практик PatternShift.

Содержит примеры конфигураций для адаптации техник визуализации
и движенческих практик под различные сенсорные модальности.
"""

from typing import Dict, Any, List
from ..dependencies import (
    PatternVAKAdaptationDependencies,
    VAKModalityType,
    AdaptationDepth,
    PatternShiftModuleType,
    create_vak_adaptation_dependencies
)


def create_visualization_config(api_key: str) -> PatternVAKAdaptationDependencies:
    """
    Создать конфигурацию для адаптации техник визуализации.

    Args:
        api_key: API ключ для LLM

    Returns:
        Настроенные зависимости для визуализаций
    """
    return create_vak_adaptation_dependencies(
        api_key=api_key,
        adaptation_depth=AdaptationDepth.COMPLETE,  # Визуализации требуют полной адаптации
        enable_multimodal=True,
        enable_safety_validation=True,
        preserve_therapeutic_integrity=True,
        max_adaptation_time_seconds=50.0,  # Визуализации могут быть сложными
        knowledge_tags=["visualization", "imagery", "vak", "pattern-shift", "guided-imagery"]
    )


def create_movement_config(api_key: str) -> PatternVAKAdaptationDependencies:
    """
    Создать конфигурацию для адаптации движенческих практик.

    Args:
        api_key: API ключ для LLM

    Returns:
        Настроенные зависимости для движения
    """
    return create_vak_adaptation_dependencies(
        api_key=api_key,
        adaptation_depth=AdaptationDepth.COMPLETE,
        enable_multimodal=True,
        enable_safety_validation=True,
        preserve_therapeutic_integrity=True,
        max_adaptation_time_seconds=45.0,
        knowledge_tags=["movement", "somatic", "vak", "pattern-shift", "embodiment"]
    )


# Примеры техник визуализации
VISUALIZATION_EXAMPLES = {
    "safe_place": {
        "visual": {
            "title": "Визуализация безопасного места (визуальная)",
            "content": """
            Закройте глаза и представьте место, где вы чувствуете себя абсолютно безопасно.
            Это может быть реальное место или созданное воображением.

            Рассмотрите это место в деталях:
            - Какие цвета вы видите? Яркие или приглушенные?
            - Какое освещение? Мягкий солнечный свет, лампа, свечи?
            - Какие объекты вас окружают? Мебель, природа, стены?
            - Есть ли движение? Развевающиеся шторы, качающиеся деревья?

            Создайте четкую, детальную картину этого места.
            Запомните каждую визуальную деталь, чтобы вернуться сюда в любой момент.
            Сделайте мысленный снимок этого места безопасности.
            """,
            "key_elements": ["детальные образы", "цвета и освещение", "визуальная память"],
            "duration": "10-15 минут"
        },
        "auditory": {
            "title": "Звуковое пространство безопасности (аудиальная)",
            "content": """
            Закройте глаза и настройтесь на создание звукового пространства безопасности.
            Это место, где звуки приносят вам покой и защищенность.

            Прислушайтесь к звукам этого места:
            - Какие фоновые звуки вы слышите? Шум прибоя, пение птиц, потрескивание камина?
            - Есть ли музыка? Какая мелодия создает ощущение безопасности?
            - Слышите ли вы голоса? Может быть, любимый человек напевает колыбельную?
            - Какова акустика пространства? Эхо, приглушенность, резонанс?

            Создайте звуковую картину, которая окутывает вас защитой.
            Запомните эту внутреннюю мелодию безопасности.
            """,
            "key_elements": ["звуковая среда", "внутренняя мелодия", "аудиальная память"],
            "duration": "10-15 минут"
        },
        "kinesthetic": {
            "title": "Телесное ощущение безопасности (кинестетическая)",
            "content": """
            Устройтесь максимально комфортно и настройтесь на ощущения абсолютной безопасности.
            Позвольте телу вспомнить или создать это состояние.

            Почувствуйте, как безопасность живет в вашем теле:
            - Какова температура этого ощущения? Теплая объятия, прохладная свежесть?
            - Какая текстура? Мягкость пледа, гладкость шелка, твердость камня?
            - Где в теле локализуется это чувство? В груди, животе, по всему телу?
            - Есть ли движение? Медленные волны, спокойное течение, неподвижность?

            Позвольте всему телу погрузиться в это ощущение безопасности.
            Запомните это состояние в каждой клетке тела.
            """,
            "key_elements": ["телесные ощущения", "температура и текстура", "соматическая память"],
            "duration": "15-20 минут"
        }
    },

    "future_self": {
        "visual": {
            "title": "Встреча с будущим собой (визуальная)",
            "content": """
            Представьте себя через 5-10 лет, когда все ваши текущие вызовы успешно преодолены.
            Увидьте себя в будущем как яркую, четкую картину.

            Рассмотрите своего будущего себя:
            - Как вы выглядите? Осанка, выражение лица, глаза?
            - Во что вы одеты? Какие цвета отражают вашу новую реальность?
            - Где вы находитесь? Какая обстановка вас окружает?
            - Что вы делаете? Какие действия отражают вашу реализованность?

            Установите визуальный контакт с будущим собой.
            Попросите показать вам путь к этому состоянию.
            Запечатлейте этот образ как маяк для вашего развития.
            """,
            "key_elements": ["образ будущего себя", "визуальный контакт", "путь развития"],
            "duration": "15-20 минут"
        },
        "auditory": {
            "title": "Диалог с будущим собой (аудиальная)",
            "content": """
            Настройтесь на внутренний диалог с собой из будущего.
            Представьте, что через 5-10 лет вы можете дать совет себе нынешнему.

            Начните разговор со своим будущим я:
            - Каким тоном говорит ваше будущее я? Мудрым, спокойным, уверенным?
            - О чем хочет вам рассказать будущий вы?
            - Какие слова поддержки вы слышите?
            - Какие конкретные советы звучат для преодоления текущих вызовов?

            Ведите этот внутренний диалог, слушая мудрость будущего себя.
            Запомните ключевые слова и фразы поддержки.
            Пусть этот голос станет внутренним наставником.
            """,
            "key_elements": ["внутренний диалог", "голос мудрости", "советы из будущего"],
            "duration": "15-20 минут"
        },
        "kinesthetic": {
            "title": "Воплощение будущего себя (кинестетическая)",
            "content": """
            Встаньте и подготовьтесь физически воплотить своего будущего себя.
            Позвольте телу принять позу и движения реализованного вы.

            Почувствуйте, как живет в теле ваше будущее я:
            - Как держится спина? Плечи? Как располагается голова?
            - Как движется ваше будущее я? Уверенно, плавно, энергично?
            - Какие ощущения в груди? Расширение, тепло, силу?
            - Как дышит ваше будущее я? Глубоко, спокойно?

            Походите в этом теле будущего себя.
            Почувствуйте разницу с текущим состоянием.
            Запомните эти ощущения силы и реализованности.
            """,
            "key_elements": ["воплощение в теле", "поза силы", "движение уверенности"],
            "duration": "15-20 минут"
        }
    }
}


# Примеры движенческих практик
MOVEMENT_EXAMPLES = {
    "grounding": {
        "visual": {
            "title": "Заземление через визуальное восприятие",
            "content": """
            Встаньте босиком на землю или представьте, что стоите на природе.
            Визуализируйте корни, растущие из ваших стоп глубоко в землю.

            Наблюдайте эти корни:
            - Какого они цвета? Коричневые, золотистые, светящиеся?
            - Какой толщины? Как далеко уходят в землю?
            - Видите ли, как они переплетаются с корнями деревьев?

            Представьте, как энергия земли поднимается по корням:
            - Увидьте поток света, поднимающийся от земли через стопы
            - Наблюдайте, как этот свет заполняет ноги, таз, торс
            - Смотрите, как вы становитесь светящимся деревом

            Визуализируйте себя как часть природного ландшафта.
            """,
            "key_elements": ["визуализация корней", "поток энергии", "единство с природой"],
            "duration": "10-15 минут"
        },
        "auditory": {
            "title": "Заземление через звуковые вибрации",
            "content": """
            Встаньте устойчиво и настройтесь на звуки заземления.
            Начните с глубокого звука "АУМ", произнося его низко и протяжно.

            Работайте со звуком заземления:
            - Произносите "АУМ" так, чтобы вибрация шла в стопы и ноги
            - Слушайте, как звук резонирует в нижней части тела
            - Добавьте звук "ХА", выдыхая через рот с облегчением

            Создайте ритм заземления:
            - Топайте стопами в ритм дыхания
            - Слушайте контакт стоп с землей
            - Позвольте каждому удару создавать звуковую волну стабильности

            Завершите в тишине, слушая внутреннюю устойчивость.
            """,
            "key_elements": ["звуковые вибрации", "ритм заземления", "резонанс в теле"],
            "duration": "10-15 минут"
        },
        "kinesthetic": {
            "title": "Физическое заземление",
            "content": """
            Встаньте босиком, почувствовав полный контакт стоп с поверхностью.
            Согните немного колени, ощущая устойчивость позы.

            Исследуйте ощущения заземления:
            - Почувствуйте вес тела, опускающийся вниз через стопы
            - Ощутите поддержку земли, поднимающуюся вверх
            - Покачайтесь вперед-назад, находя центр равновесия

            Углубите заземление через движение:
            - Медленно приседайте, чувствуя гравитацию
            - Вставайте, ощущая силу ног, толкающую вас вверх
            - Топайте стопами, создавая вибрации в ногах

            Завершите в неподвижности, чувствуя глубокое укоренение.
            """,
            "key_elements": ["физический контакт", "ощущение веса", "работа с гравитацией"],
            "duration": "10-15 минут"
        }
    },

    "emotional_release": {
        "visual": {
            "title": "Визуальное освобождение эмоций",
            "content": """
            Встаньте свободно и представьте эмоцию, которую хотите освободить, как цветной дым или туман в теле.
            Увидьте, где эта эмоция локализована и каков ее цвет.

            Начните освобождать эмоцию через визуализацию:
            - Представьте, как этот цветной дым начинает двигаться к выходам
            - Через руки - смотрите, как он вытекает через пальцы
            - Через рот - наблюдайте, как он выходит с выдохом
            - Через макушку - видите, как он поднимается вверх

            Добавьте движения рук, помогая визуально "вытягивать" эмоцию:
            - Делайте плавные движения от центра тела наружу
            - Наблюдайте, как движения рук направляют поток освобождения
            - Видите ли, как тело становится светлее и чище?

            Завершите, видя себя наполненным чистым, светлым пространством.
            """,
            "key_elements": ["визуализация эмоций", "цветные потоки", "движения освобождения"],
            "duration": "15-20 минут"
        },
        "auditory": {
            "title": "Звуковое освобождение эмоций",
            "content": """
            Встаньте свободно и настройтесь на звук эмоции, которую хотите освободить.
            Как она звучит внутри? Тяжело, резко, тихо?

            Освобождайте эмоцию через звук:
            - Начните с тихого "Ахх", выпуская напряжение
            - Позвольте звуку стать громче: "АХХ!"
            - Добавьте другие звуки: "Хэй!", "Ух!", что подсказывает тело

            Добавьте движения, поддерживающие звук:
            - Движения рук в такт звукам
            - Покачивания тела под ритм освобождения
            - Топанье ногами для усиления звуковых вибраций

            Завершите в тишине, слушая новое, более легкое звучание внутри.
            """,
            "key_elements": ["звуки освобождения", "вокальное выражение", "ритм движения"],
            "duration": "15-20 минут"
        },
        "kinesthetic": {
            "title": "Физическое освобождение эмоций",
            "content": """
            Встаньте и почувствуйте, где в теле локализована эмоция, которую хотите освободить.
            Какие ощущения она создает? Напряжение, тяжесть, сжатие?

            Начните освобождение через движение:
            - Если напряжение в плечах - покрутите и потрясите плечами
            - Если тяжесть в груди - делайте раскрывающие движения руками
            - Если зажим в животе - покрутите тазом и подышите в эту область

            Позвольте телу показать движения освобождения:
            - Тряска всем телом для высвобождения застрявшей энергии
            - Удары кулаками по воздуху для выхода злости
            - Объятия себя для освобождения грусти

            Завершите, ощущая новую легкость и свободу в теле.
            """,
            "key_elements": ["локализация в теле", "спонтанные движения", "физическое освобождение"],
            "duration": "15-20 минут"
        }
    }
}


def get_visualization_example(
    technique: str,
    modality: VAKModalityType,
    complexity_level: str = "intermediate"
) -> Dict[str, Any]:
    """
    Получить пример техники визуализации под конкретную модальность.

    Args:
        technique: Название техники
        modality: Целевая модальность
        complexity_level: Уровень сложности (beginner, intermediate, advanced)

    Returns:
        Словарь с примером техники
    """
    if technique not in VISUALIZATION_EXAMPLES:
        return {"error": f"Техника {technique} не найдена"}

    example = VISUALIZATION_EXAMPLES[technique].get(modality.value)
    if not example:
        return {"error": f"Модальность {modality} не найдена для техники {technique}"}

    # Адаптация по уровню сложности
    complexity_adjustments = {
        "beginner": {
            "additional_guidance": "Дополнительные пояснения для новичков",
            "duration_modifier": 0.8
        },
        "intermediate": {
            "additional_guidance": "Стандартный уровень детализации",
            "duration_modifier": 1.0
        },
        "advanced": {
            "additional_guidance": "Минимальные инструкции, больше самостоятельности",
            "duration_modifier": 1.3
        }
    }

    result = example.copy()
    result["complexity_level"] = complexity_level
    result["adaptations"] = complexity_adjustments.get(complexity_level, {})

    return result


def get_movement_example(
    practice: str,
    modality: VAKModalityType,
    physical_capacity: str = "normal"
) -> Dict[str, Any]:
    """
    Получить пример движенческой практики под конкретную модальность.

    Args:
        practice: Название практики
        modality: Целевая модальность
        physical_capacity: Физические возможности (limited, normal, high)

    Returns:
        Словарь с примером практики
    """
    if practice not in MOVEMENT_EXAMPLES:
        return {"error": f"Практика {practice} не найдена"}

    example = MOVEMENT_EXAMPLES[practice].get(modality.value)
    if not example:
        return {"error": f"Модальность {modality} не найдена для практики {practice}"}

    # Адаптация по физическим возможностям
    capacity_adjustments = {
        "limited": {
            "modifications": "Практика адаптирована для сидячего положения или ограниченной подвижности",
            "intensity": "низкая"
        },
        "normal": {
            "modifications": "Стандартная версия практики",
            "intensity": "средняя"
        },
        "high": {
            "modifications": "Усиленная версия с дополнительными движениями",
            "intensity": "высокая"
        }
    }

    result = example.copy()
    result["physical_capacity"] = physical_capacity
    result["adaptations"] = capacity_adjustments.get(physical_capacity, {})

    return result


# Предустановленные конфигурации
VISUALIZATION_THERAPY_CONFIG = {
    "name": "Визуализация в терапии",
    "adaptation_depth": AdaptationDepth.COMPLETE,
    "trauma_sensitive": True,
    "recommended_techniques": ["safe_place"],
    "special_considerations": [
        "Проверка на диссоциацию",
        "Возможность прерывания практики",
        "Заземляющие техники после визуализации"
    ]
}

MOVEMENT_TRAUMA_CONFIG = {
    "name": "Движение для работы с травмой",
    "adaptation_depth": AdaptationDepth.DEEP,
    "body_awareness_focus": True,
    "recommended_practices": ["grounding"],
    "special_considerations": [
        "Соматический подход",
        "Внимание к границам тела",
        "Титрация (дозированное воздействие)",
        "Ресурсирование"
    ]
}