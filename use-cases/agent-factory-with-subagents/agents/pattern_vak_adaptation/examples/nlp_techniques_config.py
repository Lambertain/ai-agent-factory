"""
Конфигурация VAK адаптации для НЛП техник PatternShift.

Содержит примеры конфигураций для адаптации НЛП техник
под различные сенсорные модальности.
"""

from typing import Dict, Any, List
from ..dependencies import (
    PatternVAKAdaptationDependencies,
    VAKModalityType,
    AdaptationDepth,
    PatternShiftModuleType,
    create_vak_adaptation_dependencies
)


def create_nlp_techniques_config(api_key: str) -> PatternVAKAdaptationDependencies:
    """
    Создать конфигурацию для адаптации НЛП техник.

    Args:
        api_key: API ключ для LLM

    Returns:
        Настроенные зависимости для НЛП техник
    """
    return create_vak_adaptation_dependencies(
        api_key=api_key,
        adaptation_depth=AdaptationDepth.DEEP,
        enable_multimodal=True,
        enable_safety_validation=True,
        trauma_informed_adaptations=True,
        preserve_therapeutic_integrity=True,
        max_adaptation_time_seconds=45.0,  # НЛП техники могут требовать больше времени
        batch_adaptation_size=5,
        knowledge_tags=["nlp", "techniques", "vak", "pattern-shift", "therapy"]
    )


# Примеры адаптации популярных НЛП техник
NLP_TECHNIQUES_EXAMPLES = {
    "anchoring": {
        "visual": {
            "title": "Визуальное якорение",
            "content": """
            Представьте яркую, четкую картину момента, когда вы чувствовали себя максимально уверенно.
            Посмотрите на эту сцену как на фотографию - какие цвета вы видите? Какое освещение?
            Теперь сфокусируйте взгляд на конкретной детали этого образа.

            Одновременно сожмите кулак, создавая видимую связь между этим ярким образом и физическим действием.
            Повторите это 5-7 раз, каждый раз четко видя тот же образ.

            Проверьте якорь: сожмите кулак и наблюдайте, как возвращается яркая картина уверенности.
            """,
            "key_elements": ["яркие образы", "визуальные детали", "наблюдение связей"],
            "pace": "быстрый",
            "structure": "короткие инструкции"
        },
        "auditory": {
            "title": "Аудиальное якорение",
            "content": """
            Прислушайтесь к внутреннему звучанию момента максимальной уверенности.
            Услышьте тон своего голоса в тот момент, ритм дыхания, возможно, фоновые звуки.
            Настройтесь на эту внутреннюю мелодию уверенности.

            Теперь, слушая эти звуки, сожмите кулак, создавая звуковую связь.
            Повторите это несколько раз, каждый раз слушая ту же внутреннюю мелодию.

            Проверьте: сожмите кулак и прислушайтесь - звучит ли снова мелодия уверенности?
            """,
            "key_elements": ["внутренние звуки", "ритм", "тональность", "звуковые связи"],
            "pace": "средний",
            "structure": "ритмичные повторы"
        },
        "kinesthetic": {
            "title": "Кинестетическое якорение",
            "content": """
            Медленно погрузитесь в телесные ощущения момента максимальной уверенности.
            Почувствуйте, как это состояние живет в вашем теле - в какой части груди ощущается тепло?
            Как расслаблены или напряжены плечи? Какова текстура этого чувства уверенности?

            Осознанно, медленно сожмите кулак, ощущая, как это движение соединяется с чувством уверенности.
            Прочувствуйте эту связь в теле. Повторите несколько раз, каждый раз глубже ощущая связь.

            Проверьте якорь: сожмите кулак и почувствуйте, как в теле поднимается волна уверенности.
            """,
            "key_elements": ["телесные ощущения", "глубокое чувствование", "медленные движения"],
            "pace": "медленный",
            "structure": "детальные описания"
        }
    },

    "reframing": {
        "visual": {
            "title": "Визуальный рефрейминг",
            "content": """
            Представьте проблемную ситуацию как картину в рамке.
            Рассмотрите эту картину - какого она размера? Цветная или черно-белая?
            Теперь мысленно измените рамку - сделайте ее больше, включите больше контекста.

            Посмотрите на ту же ситуацию с разных углов зрения:
            - Вид сверху (перспектива мудреца)
            - Вид со стороны (взгляд наблюдателя)
            - Вид изнутри (ваша текущая позиция)

            Какие новые детали становятся видны? Как меняется общая картина?
            """,
            "key_elements": ["визуальные перспективы", "изменение рамки", "разные углы"],
            "pace": "быстрый",
            "structure": "пошаговая визуализация"
        },
        "auditory": {
            "title": "Аудиальный рефрейминг",
            "content": """
            Послушайте, как звучит ваша проблемная ситуация во внутреннем диалоге.
            Какой тон, ритм, громкость у этого внутреннего голоса?

            Теперь представьте, что эту же ситуацию комментируют разные голоса:
            - Мудрый наставник (спокойный, глубокий тон)
            - Поддерживающий друг (теплый, понимающий голос)
            - Эксперт в этой области (уверенный, знающий тон)

            Прислушайтесь к каждому голосу. Как они по-разному рассказывают о вашей ситуации?
            Какие новые интонации помогают услышать возможности?
            """,
            "key_elements": ["внутренний диалог", "разные голоса", "тональность"],
            "pace": "средний",
            "structure": "диалоговая форма"
        },
        "kinesthetic": {
            "title": "Кинестетический рефрейминг",
            "content": """
            Ощутите, как проблемная ситуация ощущается в вашем теле.
            Где локализуется напряжение? Какова текстура этого ощущения - острая, тяжелая, сжимающая?

            Теперь медленно, осознанно измените позу вашего тела:
            - Выпрямите спину (почувствуйте силу)
            - Расслабьте плечи (ощутите освобождение)
            - Глубоко вдохните (прочувствуйте расширение)

            Как с изменением позы меняется ощущение ситуации?
            Какие новые чувства и понимания приходят через тело?
            Позвольте новому ощущению полностью заполнить пространство старого.
            """,
            "key_elements": ["телесные ощущения", "изменение позы", "глубокое чувствование"],
            "pace": "медленный",
            "structure": "поэтапное погружение"
        }
    },

    "six_step_reframe": {
        "visual": {
            "title": "Шестишаговый рефрейминг (визуальный)",
            "content": """
            ШАГ 1: Представьте вашу нежелательную реакцию как яркую картинку.
            ШАГ 2: Мысленно "поговорите" с этой частью, увидев ее как отдельный образ.
            ШАГ 3: Визуализируйте "мудрую часть" себя - как она выглядит?
            ШАГ 4: Наблюдайте диалог между двумя образами.
            ШАГ 5: Увидьте, как рождаются новые, яркие варианты поведения.
            ШАГ 6: Представьте картину будущего с новыми способами реагирования.
            """,
            "key_elements": ["четкие образы частей", "визуальный диалог", "картины будущего"],
            "pace": "структурированный",
            "structure": "пошаговая схема"
        },
        "auditory": {
            "title": "Шестишаговый рефрейминг (аудиальный)",
            "content": """
            ШАГ 1: Прислушайтесь к "голосу" вашей нежелательной реакции.
            ШАГ 2: Мягко заговорите с этой частью, услышав ее ответ.
            ШАГ 3: Настройтесь на голос вашей "мудрой части".
            ШАГ 4: Организуйте внутренний диалог между голосами.
            ШАГ 5: Послушайте, как звучат новые варианты поведения.
            ШАГ 6: Услышьте, как будет звучать ваша жизнь с новыми способами.
            """,
            "key_elements": ["внутренние голоса", "диалог частей", "звучание изменений"],
            "pace": "ритмичный",
            "structure": "поэтапный диалог"
        },
        "kinesthetic": {
            "title": "Шестишаговый рефрейминг (кинестетический)",
            "content": """
            ШАГ 1: Почувствуйте, где в теле живет ваша нежелательная реакция.
            ШАГ 2: Мягко, с пониманием "дотроньтесь" до этой части себя.
            ШАГ 3: Ощутите присутствие мудрой, заботливой части в другом месте тела.
            ШАГ 4: Почувствуйте, как эти части "общаются" через ощущения.
            ШАГ 5: Позвольте возникнуть новым, более комфортным способам реагирования.
            ШАГ 6: Прочувствуйте, как эти новые способы укореняются в теле.
            """,
            "key_elements": ["локализация в теле", "тактильное общение", "укоренение изменений"],
            "pace": "медленный, глубокий",
            "structure": "поэтапное погружение"
        }
    }
}


def get_nlp_adaptation_example(
    technique: str,
    modality: VAKModalityType,
    include_coaching_notes: bool = True
) -> Dict[str, Any]:
    """
    Получить пример адаптации НЛП техники под конкретную модальность.

    Args:
        technique: Название техники
        modality: Целевая модальность
        include_coaching_notes: Включить заметки для коучей

    Returns:
        Словарь с примером адаптации
    """
    if technique not in NLP_TECHNIQUES_EXAMPLES:
        return {"error": f"Техника {technique} не найдена"}

    if modality.value not in NLP_TECHNIQUES_EXAMPLES[technique]:
        return {"error": f"Модальность {modality} не найдена для техники {technique}"}

    example = NLP_TECHNIQUES_EXAMPLES[technique][modality.value].copy()

    if include_coaching_notes:
        coaching_notes = {
            VAKModalityType.VISUAL: [
                "Используйте визуальные материалы и схемы",
                "Говорите быстрее, фокусируйтесь на результатах",
                "Предлагайте клиенту рисовать или схематизировать",
                "Используйте пространственные метафоры"
            ],
            VAKModalityType.AUDITORY: [
                "Обращайте внимание на тон и ритм речи",
                "Используйте повторы и логические связки",
                "Предлагайте проговаривание вслух",
                "Включайте элементы диалога и обсуждения"
            ],
            VAKModalityType.KINESTHETIC: [
                "Замедляйте темп, делайте паузы",
                "Включайте физические движения и позы",
                "Обращайте внимание на телесные ощущения",
                "Используйте метафоры движения и прикосновения"
            ]
        }
        example["coaching_notes"] = coaching_notes.get(modality, [])

    return example


def create_custom_nlp_config(
    api_key: str,
    preferred_techniques: List[str],
    adaptation_style: str = "balanced"
) -> Dict[str, Any]:
    """
    Создать кастомную конфигурацию для специфических НЛП техник.

    Args:
        api_key: API ключ
        preferred_techniques: Список предпочитаемых техник
        adaptation_style: Стиль адаптации (balanced, visual-focused, auditory-focused, kinesthetic-focused)

    Returns:
        Кастомная конфигурация
    """
    adaptation_configs = {
        "balanced": {
            "visual_weight": 0.33,
            "auditory_weight": 0.33,
            "kinesthetic_weight": 0.34,
            "multimodal_preferred": True
        },
        "visual-focused": {
            "visual_weight": 0.6,
            "auditory_weight": 0.2,
            "kinesthetic_weight": 0.2,
            "multimodal_preferred": False
        },
        "auditory-focused": {
            "visual_weight": 0.2,
            "auditory_weight": 0.6,
            "kinesthetic_weight": 0.2,
            "multimodal_preferred": False
        },
        "kinesthetic-focused": {
            "visual_weight": 0.2,
            "auditory_weight": 0.2,
            "kinesthetic_weight": 0.6,
            "multimodal_preferred": False
        }
    }

    base_config = create_nlp_techniques_config(api_key)
    style_config = adaptation_configs.get(adaptation_style, adaptation_configs["balanced"])

    return {
        "dependencies": base_config,
        "technique_preferences": preferred_techniques,
        "adaptation_weights": style_config,
        "available_examples": list(NLP_TECHNIQUES_EXAMPLES.keys())
    }


# Предустановленные конфигурации для разных контекстов
NLP_THERAPY_CONFIG = {
    "name": "НЛП в терапии",
    "adaptation_depth": AdaptationDepth.DEEP,
    "safety_priority": "high",
    "recommended_techniques": ["reframing", "anchoring", "six_step_reframe"],
    "avoid_techniques": [],  # В терапии все техники можно адаптировать
    "special_considerations": [
        "Травма-информированный подход",
        "Особое внимание к безопасности",
        "Сохранение терапевтических границ"
    ]
}

NLP_COACHING_CONFIG = {
    "name": "НЛП в коучинге",
    "adaptation_depth": AdaptationDepth.MODERATE,
    "safety_priority": "medium",
    "recommended_techniques": ["anchoring", "reframing", "goal_setting"],
    "performance_focus": True,
    "special_considerations": [
        "Фокус на достижениях",
        "Быстрая практическая применимость",
        "Развитие навыков"
    ]
}

NLP_EDUCATION_CONFIG = {
    "name": "НЛП в образовании",
    "adaptation_depth": AdaptationDepth.SURFACE,
    "safety_priority": "medium",
    "recommended_techniques": ["anchoring", "learning_strategies"],
    "age_appropriate": True,
    "special_considerations": [
        "Адаптация под возраст",
        "Групповая применимость",
        "Образовательный контекст"
    ]
}